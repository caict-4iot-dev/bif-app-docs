# 星火时戳

## 产品简介

---

星火时戳是星火·链网面向骨干节点及可信用户提供的一项公共服务，基于国家授时中心权威时间源，保障时间的授时和守时监测，结合相关时间技术与服务标准，将用户的电子数据摘要和权威时间源记录绑定，用星火·链网数字签名生成时间戳（可在中国科学院中国科技网官网进行验证），从而使用户获得可信时间信息，并提供对可信时间来源和精度的验证功能，用以解决电子数据时间的可信性和权威性问题。

星火时戳可为电子数据提供权威可信时间证明和内容真实性、完整性证明，能够有效证明电子文件生成的精确时间，并防止电子文件被篡改，使用国家授时中心权威时间源，具有权威性和可信赖性，符合国家标准和《电子签名法》要求，让电子合同、电子存证等各类电子数据、电子文件具备法律效力。
>  访问地址：https://ts.bitfactory.cn/

### 产品特点

<center>
<img src="docs/可信存证服务/可信时戳/image/产品概述-1.png" width="30%" width="50%">
</center>

**权威：**由国家授时中心和星火·链网共同提供服务；

**高精度：**面向各行业提供毫秒级的时间服务；

**可信：**通过高精度时钟与国家授时中心标准时间源进行同步；

**可验：**由国家授时中心出具时间可信性报告，并可在第三方官网进行查验；

### 应用场景

公检法司：解决卷宗/视频取证、时间同步和证据固化问题；

数字资产保护：提供企业、个人数字资产的确权、存证、鉴权及维权服务；

物品追溯：提供全业务流程可信存证及信息追溯问题；

环境保护：提供环保监测存证，环保执法取证中的时间同步及证据固化问题；

### 主要功能

**时间戳：** 为电子数据获取时间戳；

**核验：** 对时间戳在第三方官网上进行核验；

## 用户使用手册

---

星火时戳系统是解决电子数据的时间可信和权威性认证问题的时间戳服务系统，基于国家标准时间，通过与授时专用硬件相结合，建设标准时间落地应用，实现标准时间面向不同网络空间的可溯源、可监控、可管理目的，为互联网应用、行业专网应用提供标准时间服务支撑。用户可通过本该系统获取和查验星火时戳凭证，从而获得可信时间信息，并提供对可信时间的来源和精度进行有效验证。  
本文档是星火时戳系统的用户使用手册，详细描述了星火时戳系统中每一个功能的具体操作，并对各功能模块和相关功能进行了讲解。通过认真阅读该操作手册，用户可以更好地理解星火时戳系统的运行机制、充分利用系统的功能。

### 术语

星火时戳系统：星火时戳系统是可信存证服务网络（CAP）中的一个解决电子数据的时间可信和权威性认证问题的时间戳服务系统，用户可以通过本系统获取和查验星火时戳凭证，从而获得可信时间信息，并提供对可信时间的来源、精度进行有效验证。
星火时戳凭证：星火时戳凭证是由星火时戳系统针对用户的电子数据颁发的时间证明，该证明包括星火时戳凭证编号、时间、事物HASH值等。其中的时间可以溯源到国家标准时间。该证明可以被第三方查验系统进行验证。 
事物HASH：需要获取星火时戳凭证的电子数据HASH值。

### 角色和职能

系统分为超级管理员、区域管理员和用户三个角色，其中用户角色在系统中可申请JWT token，使用调用凭据管理、时间戳统计分析、时间戳管理功能，查看与自己相关的信息。 

### 运行环境

本系统为WEB网站，需通过网页浏览器访问，硬件设备使用普通笔记本电脑或台式机均可。软件使用Chrome浏览器99.0.4844.51 (x86_64) 以上版本和360极速浏览器 12.2.1640.0以上版本均可访问本系统，优先推荐Chrome浏览器最新版本。

**登录**

本系统基于星火通数字钱包使用星火数字身份登录系统，并确保数字身份拥有星火企业可信认证凭证。

**安装星火通数字钱包**：访问https://bitfactory.cn/szsf.html ，在星火通数字钱包点击【浏览器插件】。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-1.png" width="100%" width="100%">
</center>

下载浏览器插件，下载成功后为Zip压缩包，将压缩包解压至任意目录。点击谷歌浏览器中的拓展程序，进入界面后开启开发者模式，点击加载已解压的拓展程序。加载成功后跳转星火通登录、注册页面。

> 新注册的用户需通过管理员添加权限，才可登录星火时戳系统。   

在浏览器中输入登录地址：https://ts.bitfactory.cn/ ，打开系统登录页面，点击【快速授权登录】调用星火通浏览器插件钱包（确保星火通插件钱包已安装，并拥有账号及星火可信凭证）进行登录认证。认证通过后，进入首页页面。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-2.png" width="100%" width="100%">
</center>

**主页**

上方：消息，个人信息，退出按钮。   
左侧：导航栏包含所有操作功能模块。   
正文：时间戳调用（近7天），时间戳调用（当天），可放大图标查看对应的统计图表。  
用户可以查看其下各个应用的数据统计。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-3.png" width="100%" width="100%">
</center>

系统主要包含了调用凭据管理、时间戳统计分析、时间戳管理、状态监控、审计日志和系统管理等功能。可以查看调用凭据、时间戳信息、时间戳分析情况、服务状态、日志和系统相关信息。

### 调用凭据管理

使用星火时戳，需要先在调用凭据管理中创建应用。调用凭据管理包含创建、修改、查看、删除应用以及操作对应应用下的token等功能。

##### 应用

登录系统，进入创建新的应用，可修改、删除、查看已创建的应用。
点击【创建应用】按钮进行创建。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-4.png" width="100%" width="100%">
</center>

完成信息填写后点击【确定】，完成应用的创建。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-5.png" width="100%" width="100%">
</center>

点击【编辑】和【删除】按钮，可对创建的应用进行编辑修改和删除。

##### Token

使用星火时戳，在调用凭据管理中创建应用后，还需要在对应的应用下再创建【创建JWT token】。创建成功后可在界面中复制token即可在星火时戳接口的调用时使用。JWT token创建成功后请在IP白名单中添加调用服务器的IP（默认全部禁止访问），否则将无法成功调用。 
（备注：创建 JWT token时，可根据实际情况对生效时间和过期时间进行设置） 
点击【创建JWT token】，进行token的创建。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-6.png" width="100%" width="100%">
</center>

填入对应信息，点击【确定】完成创建。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-7.png" width="100%" width="100%">
</center>

点击【白名单】按钮可以设置token的白名单IP。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-8.png" width="100%" width="100%">
</center>

点击【重置】按钮，可对token进行修改重置。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-9.png" width="100%" width="100%">
</center>

点击【删除】按钮，可将token删除。

### 时间戳接口调用

在应用下创建JWT token后，将接口调用服务器的IP添加至白名单，复制JWT token，使用JWT token即可调用时间戳接口。 详见API文档。

### 时间戳统计分析

时间戳统计分析可以对任意时间范围内、任意应用的调用情况进行分析。
上方选项卡可以选择7天、15天、30天固定时间进行分析也可以选择任意时间范围进行分析，通过选择应用缩小分析统计范围。确定应用后还可以通过选择JWT token进一步缩小统计范围。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-10.png" width="100%" width="100%">
</center>

### 时间戳管理

在时间戳管理中可以查看时间戳文件编号、签发时间、时间戳签发详情以及时间戳文件导出。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-11.png" width="100%" width="100%">
</center>

可以通过时间范围、上传文件计算HASH、时间戳文件编号与电子指纹（HASH值）进行该用户所属时间戳文件的查询。点击查询数据后的【查看】按钮，可查看时间戳签发详情。点击详情数据后的【导出】按钮，可将时间戳文件导出。

### 时间戳验证

已完成的时间戳可以在中国科学院~~~~中国科技网官网进行验证，访问[中国科技网](https://www.cstnet.cn/)，在运行服务模块找到时间戳查验，点击查验。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-12.png" width="100%" width="100%">
</center>

进入时间戳查验界面，如下图：

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-13.png" width="100%" width="100%">
</center>

输入必填信息，点击【立即验证】，进行验证。

<center>
<img src="docs/可信存证服务/可信时戳/image/使用手册-14.jpg" width="100%" width="100%">
</center>

可下载时间戳认证证书。

> 时间戳认证证书在时间戳生成24小时后才可以下载。

## API文档

### 名词解释

**星火时戳系统**   ：星火时戳系统是解决电子数据的时间可信和权威性认证问题的时间戳服务系统，用户可以通过本系统获取和查验星火时戳凭证，从而获得可信时间信息，并提供对可信时间的来源、精度进行有效验证。    

**星火时戳凭证**：星火时戳凭证是由星火时戳系统针对用户的电子数据颁发的时间证明，该证明包括星火时戳凭证编号、时间、事物HASH值等，其中的时间可以溯源至国家标准时间。该证明可在中国科学院中国科技网官网进行验证。  

**事物HASH**：需要获取星火时戳凭证的电子数据HASH值。

### 接入说明

**注册：** 用户必须拥有BID账户，并获得星火企业可信认证，由各区域管理员进行创建添加用户后，方可通过星火通登录星火时戳系统进行业务操作。   
**新建应用：** 登录管理平台，进入调用凭据管理，创建新的应用。   
**创建JWT token：** 在应用下创建JWT token，创建成功后可在界面中可复制token进行星火时戳接口的调用，同时请在IP白名单中添加调用服务器的IP（默认全部禁止访问），否则将无法成功调用。   

> Note：创建 JWT token时，可根据实际情况对生效时间和过期时间进行设置。   

### 获取时间戳接口（上传文件）

**协议：** HTTPS  
**请求方式：** POST  
**URL：** https://ts.bitfactory.cn/v1/file  
**请求参数**  

| 参数            | 类型  | 是否必须 | 放置位置             | 说明                    |
| ------------- | --- | ---- | ---------------- | --------------------- |
| Authorization | 字符串 | 是    | Header    Bearer | 拼接调用凭据的JWT token凭证    |
| file          | 文件  | 是    | Body             | 上传的文件计算hash值（文件小于5MB） |

<center>
<img src="docs/可信存证服务/可信时戳/image/API-1.jpg" width="100%" width="100%">
</center>

<center>
<img src="docs/可信存证服务/可信时戳/image/API-2.jpg" width="100%" width="100%">
</center>

返回说明：  
正常情况下返回的响应体Response->Header-> Content-Type的值为“application/timestamp-response“,此时可信星火时戳凭证文件（.tsr）将以二进制流方式存放在Response->Body中,而相关的描述信息放置在Response->Header->Content-Disposition中。如下图：

<center>
<img src="docs/可信存证服务/可信时戳/image/API-3.jpg" width="100%" width="100%">
</center>

异常情况下返回的错误描述直接存放在Response->Body如下图： 

<center>
<img src="docs/可信存证服务/可信时戳/image/API-3.jpg" width="100%" width="100%">
</center>

异常情况下返回的错误描述直接存放在Response->Body如下图：  

<center>
<img src="docs/可信存证服务/可信时戳/image/API-5.jpg" width="100%" width="100%">
</center>

### 获取时间戳接口（上传HASH值）

**协议：** HTTPS  
**请求方式：** GET  
**URL：** https://ts.bitfactory.cn/v1/tsr请求参数  

| 参数            | 类型  | 是否必须 | 放置位置             | 说明                 |
| ------------- | --- | ---- | ---------------- | ------------------ |
| Authorization | 字符串 | 是    | Header    Bearer | 拼接调用凭据的JWT token凭证 |
| hash          | 文件  | 是    | Params           | hash值              |

<center>
<img src="docs/可信存证服务/可信时戳/image/API-6.jpg" width="100%" width="100%">
</center>

<center>
<img src="docs/可信存证服务/可信时戳/image/API-7.jpg" width="100%" width="100%">
</center>

返回说明：
正常情况下返回的响应体Response->Header-> Content-Type的值为“application/timestamp-response“,此时可信星火时戳凭证文件（.tsr）将以二进制流方式存放在Response->Body中,而相关的描述信息放置在Response->Header->Content-Disposition中。如下图： 

<center>
<img src="docs/可信存证服务/可信时戳/image/API-8.jpg" width="100%" width="100%">
</center>

<center>
<img src="docs/可信存证服务/可信时戳/image/API-9.jpg" width="100%" width="100%">
</center>

异常情况下返回的错误描述直接存放在Response->Body如下图：

<center>
<img src="docs/可信存证服务/可信时戳/image/API-10.jpg" width="100%" width="100%">
</center>

### 错误代码说明

| 错误码 | 说明                |
| --- | ----------------- |
| 801 | 请求的算法参数错误         |
| 802 | 请求的文件不存在          |
| 803 | 请求的哈希值为空          |
| 804 | 请求的令牌还未到生效时间      |
| 805 | 请求的令牌已过期          |
| 806 | 当前请求地址IP不在JWT白名单内 |
| 807 | 服务器内部错误           |
| 808 | 请求的令牌解析错误         |

## 常见问题

---

#### 如何登录平台？

答：需要管理员分配账号，通过账号登录。

#### 如何获得JWT token？

答：登录系统后，先创建应用，在应用下创建JWT token即可。
